var YMap=window.YMap||{};var $=Y.useJQuery();var Parameter=YMap.Parameter=function(a){this.params={fa:"default",lat:null,lon:null,z:null,datum:"wgs",mode:"map",type:"scroll",layout:"normal",submap:"close",stmore:"close",weather:"open",pointer:"on",hold:"off",home:"on",hlat:"",hlon:"",p:"",q:"",ei:"utf-8",b:1,n:10,st:0,dist:null,relays:"",lat0:"",lon0:"",lat1:"",lon1:"",uid:"",pop:"",rsn0:"",rsn1:"",paper:"",orientation:"",full_tip:"open",heat_tip:"open",mmc:200,mlc:200};
this.load(a);};Parameter.DEFAULT_URL_PARAMS=["lat","lon","datum","z","mode","type","pointer","home","hlat","hlon","fa","p","q","ei","b","n","dist","uid","pop","lat0","lat1","lon0","lon1","rsn0","rsn1"];YMap.Parameter.FUNC_MAPSEARCH="ks";YMap.Parameter.FUNC_AREASEARCH="as";YMap.Parameter.FUNC_WAIWAISEARCH="ws";YMap.Parameter.FUNC_BLOGSEARCH="bs";YMap.Parameter.FUNC_HEATMAP="hm";YMap.Parameter.FUNC_ROUTESEARCH="rs";
YMap.Parameter.FUNC_ROUTESEARCH_STATION="rss";YMap.Parameter.FUNC_GEOXML="gx";YMap.Parameter.prototype.load=function(a){var b=0;var c=this;if(typeof(a)==="object"){$.each(a,function(d,e){if(e&&e.toString().length>0){c.set(d,e);b++;}});}this.isNoParameter=(b==2);};YMap.Parameter.prototype.isNumber=function(a){if(!a){return false;}else{if(a==""){return false;}}return !isNaN(a);};YMap.Parameter.prototype.getBbox=function(){if(this.isNumber(this.params.lat0)&&this.isNumber(this.params.lon0)&&this.isNumber(this.params.lat1)&&this.isNumber(this.params.lon1)){return new Y.LatLngBounds([new Y.LatLng(this.params.lat0,this.params.lon0),new Y.LatLng(this.params.lat1,this.params.lon1)]);
}return null;};YMap.Parameter.prototype.getMapMode=function(){switch(this.params.mode){case"map":return Y.NORMAL_LAYERSET;break;case"aero":case Y.PHOTO_LAYERSET:return Y.PHOTO_LAYERSET;break;case"b1":case Y.B1_LAYERSET:return Y.B1_LAYERSET;break;default:return Y.NORMAL_LAYERSET;break;}};YMap.Parameter.prototype.getCenter=function(){if(this.isNumber(this.params.lat)&&this.isNumber(this.params.lon)){return new Y.LatLng(parseFloat(this.params.lat),parseFloat(this.params.lon));
}else{var a=this.getBbox();if(a){return a.getCenter();}}return new Y.LatLng(35.665818701569016,139.73087297164147);};YMap.Parameter.prototype.getFrom=function(){if(this.isNumber(this.params.lat0)&&this.isNumber(this.params.lon0)){return new Y.LatLng(this.params.lat0,this.params.lon0);}return null;};YMap.Parameter.prototype.getTo=function(){if(this.isNumber(this.params.lat1)&&this.isNumber(this.params.lon1)){return new Y.LatLng(this.params.lat1,this.params.lon1);
}return null;};YMap.Parameter.prototype.getHomeLatLng=function(){if(this.isNumber(this.params.hlat)&&this.isNumber(this.params.hlon)){return new Y.LatLng(this.params.hlat,this.params.hlon);}return this.getCenter();};YMap.Parameter.prototype.getUrlQuery=function(e){e=e||Parameter.DEFAULT_URL_PARAMS;var c={};for(var b in e){var a=e[b];var d=this.params[a];if(d&&d!=""){c[a]=d;}}return c;};YMap.Parameter.prototype.getUrlQueryString=function(d){var c=this.getUrlQuery(d);
var b=[];for(var a in c){b.push(a+"="+encodeURIComponent(c[a]));}return b.join("&");};YMap.Parameter.prototype.getRouteParam=function(){var a={from:this.getFrom(),to:this.getTo(),options:{from_label:this.get("rsn0"),to_label:this.get("rsn1")}};return a;};YMap.Parameter.prototype.set=function(a,b){if(a==="lat"||a==="lon"){}this.params[a]=b;};YMap.Parameter.prototype.get=function(a){return this.params[a];
};YMap.Parameter.prototype.getParams=function(){return this.params;};YMap.Parameter.prototype.getCookie=function(){var b=this;var a={cmd:"get"};$.ajax({url:"/cookie?cmd=get",dataType:"json",success:function(c){for(var d in c){b.set(d,c[d]);}$m.showFullTip();}});};YMap.Parameter.prototype.setCookie=function(a){var b={cmd:"set"};b[a]=this.get(a);$.ajax({url:"/cookie",data:b,dataType:"json",success:function(c){}});
};var YMap=window.YMap||{};var $=Y.useJQuery();YMap.Embed={init:function(a){this.ctrl=new Object();this.param=new Parameter(a);var b=this;$(document).ready(function(){b.initMap();});},initMap:function(){var e=this;if($("#id_map").width()==0){setTimeout(function(){e.initMap();},100);return;}var a=this.param.getCenter();var d=this.param.get("z");var c=this.param.getMapMode();this.ymap=new Y.Map("id_map");
this.ymap.drawMap(a,d,c);this.ymap.addControl(new Y.ZoomControl());this.ymap.addControl(new Y.ScaleControl());this.ctrl.homeCtrl=new Y.HomeControl({latlng:this.param.getHomeLatLng(),visible:(this.param.get("home")!="off"),visibleButton:(this.param.get("homebtn")=="on")});if(this.param.get("homebtn")=="on"){this.ymap.addControl(new Y.LayerSetControl(),new Y.ControlPosition(Y.ControlPosition.TOP_RIGHT,new Y.Size(27,5)));
this.ymap.addControl(this.ctrl.homeCtrl,new Y.ControlPosition(Y.ControlPosition.TOP_RIGHT,new Y.Size(5,5)));}else{this.ymap.addControl(new Y.LayerSetControl());this.ymap.addControl(this.ctrl.homeCtrl);}this.ymap.addControl(new Y.CenterMarkControl({visible:this.param.get("pointer")!="off"}));var b=this.param.get("fa");switch(b){case YMap.Parameter.FUNC_ROUTESEARCH:case YMap.Parameter.FUNC_ROUTESEARCH_STATION:this.drawRoute();
break;case YMap.Parameter.FUNC_HEATMAP:this.drawHeat();break;}},drawRoute:function(){var c=this.param.getFrom();var b=this.param.getTo();if(c&&b){var a=new Y.NavigationLayer({autoPanMap:false});this.ymap.addLayer(a);a.drawRoute(this.param.getFrom(),this.param.getTo(),{from_label:this.param.get("rsn0"),to_label:this.param.get("rsn1")});}},drawHeat:function(){var b=this.param.get("p");var a=new Y.GeoSearchHeatmapLayer();
this.ymap.addLayer(a);a.drawHeat(b);}};var YGeoSearchDotLayer=Y.extend(Y.GeoSearchLayer,function(){Y.GeoSearchLayer.apply(this);this.autoPanMap=false;});YGeoSearchDotLayer.prototype.initialize=function(a){Y.GeoSearchLayer.prototype.initialize.apply(this,[a]);this.setAutoUpdate(true,2,2);};YGeoSearchDotLayer.prototype.getCustomIcon=function(b,c){var a=new Y.Icon("");a.iconHtml=$('<p class="yolp-grnicn"></p>').append($('<img src="'+Y.ICON_IMAGE_URL+'" alt="" />').loadAlphaImage());
a.iconSize=new Y.Size(11,13);a.iconAnchor=new Y.Point(3,11);a.infoWindowAnchor=new Y.Point(4,0);a.labelAnchor=new Y.Point(6,-5);return a;};YGeoSearchDotLayer.prototype.getApiRequest=function(c,b){b.detail=b.detail||"simple";b.opt=b.opt||{};b.opt.rep=b.opt.rep||1;b.opt.sort="score";b.opt.appid=Y.APPID;if(this.map){var a=(this.map.currentLayerSetId=="map-b1")||(this.map.currentLayerSetId=="b1");if(a){b.opt.fl="b1";
}else{b.opt.fl="";}b.opt.fl+="&dl=2,1,0";}if($m.getSearchMinZoom&&this.map&&this.map.getZoom()<$m.getSearchMinZoom()){return false;}var d=this.map.getZoom();if(d>=15&&b.bbox){b.center=b.bbox.getCenter();}return Y.GeoSearchLayer.prototype.getApiRequest.apply(this,[c,b]);};YGeoSearchDotLayer.prototype.openInfoWindow=function(a,c){var d=this;var b={};this.search("",{detail:"old",opt:{uid:a.id,rep:3}},function(e){a=e.features[0];
a.icon=d.getCustomIcon(0,a);a.layer=d;d.search(d.query,{detail:"old",center:a.getLatLng(),dist:0.01},function(g){var j=$('<div class="fkdsh"></div>');j.append(d.createInfoWindowHtml(a));for(var h in g.features){var k=g.features[h];if(k.id!=a.id){j.append("<hr />");j.append(d.createInfoWindowHtml(k));}}if(c){b.maximize=true;maxContent=d.createInfoWindowMaxContentHtml(a);if(maxContent){b.maxContent=maxContent;
}}if(d.isHidden()){d.infoWindow=d.map.openInfoWindow(a.getLatLng(),j,b);}else{d.infoWindow=a.openInfoWindow(j,b);}d.infoWindowFeature=a;});});};var YGeoSearchLayer=Y.extend(Y.GeoSearchLayer,function(a){Y.GeoSearchLayer.apply(this,[a]);});YGeoSearchLayer.prototype.remove=function(){if(this.select){this.unbind(this.select);this.select=null;}if(this.unselect){this.map.unbind(this.unselect);this.unselect=null;
}Y.GeoSearchLayer.prototype.remove.apply(this);};YGeoSearchLayer.prototype.initialize=function(a){Y.GeoSearchLayer.prototype.initialize.apply(this,[a]);this.setAutoUpdate(true,2,1);Y.Event.addListener(a,"infowindowmaxmizeend",function(){$(".mid_summary_image img").each(function(){$m.resizeImage(this,120,90);});});};YGeoSearchLayer.prototype.getApiRequest=function(c,b){b.detail=b.detail||"old";b.opt=b.opt||{};
b.opt.rep=b.opt.rep||1;b.opt.sort=b.opt.sort||"score";b.opt.appid=Y.APPID;b.opt.info="geo";if(this.map){var a=(this.map.currentLayerSetId=="map-b1")||(this.map.currentLayerSetId=="b1");if(a){b.opt.fl="b1";}else{b.opt.fl="";}b.opt.fl+="&dl=2,1,0";}if($m.getSearchMinZoom&&this.map&&this.map.getZoom()<$m.getSearchMinZoom()){return false;}if(this.map&&this.map.getZoom()>=15&&b.bbox){b.center=b.bbox.getCenter();
}return Y.GeoSearchLayer.prototype.getApiRequest.apply(this,[c,b]);};YGeoSearchLayer.prototype.getCustomIcon=function(a){var b=new Y.Icon("");b.iconHtml=$('<p class="yolp-listnum'+(a+1)+'">').append($('<img src="'+Y.ICON_IMAGE_URL+'" alt=""/>').loadAlphaImage());b.iconSize=new Y.Size(24,35);b.iconAnchor=new Y.Point(12,35);b.labelAnchor=new Y.Point(12,-22);b.infoWindowAnchor=new Y.Point(12,0);return b;
};YGeoSearchDotLayer.prototype.openInfoWindowOfUid=YGeoSearchLayer.prototype.openInfoWindowOfUid=function(d,c){if(!this.ydf){return;}for(var b=0;b<this.ydf.result.count;b++){var a=this.ydf.features[b];if(a.id==d){this.openInfoWindow(a,c);return true;}}return false;};YGeoSearchLayer.prototype.ydfFilter=function(h){if(this.options.opt&&this.options.opt.uid){var e=this.options.opt.uid.split(",");var d=[];
for(var c in e){var b=e[c];for(var a in h.features){var g=h.features[a];if(g.id==b){d.push(g);break;}}}h.features=d;}return h;};YGeoSearchLayer.prototype.createWaiWaiPreview=function(d,b){var e=$('<ul class="pstspt"></ul>');if(this.map.getCurrentLayerSetId()==Y.B1_LAYERSET){return e.hide();}if(this.map&&$m.getSearchWaiwaiMinZoom&&this.map.getZoom()<$m.getSearchWaiwaiMinZoom()){return e.hide();}if(b.dist){return e.hide();
}var c=new YWaiWaiSearchLayer();var a={};a.bbox=b.bbox;c.search(d,a,function(j){if(j.result.count>0){e.show();e.append($('<li class="pstsptall"><a href="javascript:void(0);">'+d+"に関する投稿スポット</a></li>").click(function(){setTimeout(function(){$m.searchPoi(d,Parameter.FUNC_WAIWAISEARCH);},0);}));for(var g in j.features){var h=j.features[g];e.append($("<li></li>").click((function(f){return function(){setTimeout(function(){$m.searchPoi(d,Parameter.FUNC_WAIWAISEARCH,{uid:f,pop:"normal"});
},0);};})(h.id)).append('<img class="mrkarrw" alt="" src="http://i.yimg.jp/images/clear.gif"/>').append("<a href='javascript:void(0);'>"+h.name+"</a>"));if(g>0){break;}}}else{e.hide();}});return e;};YGeoSearchLayer.prototype.createResultHtml=function(d,c,a){var b=$('<div class="yolp-list"></div>');if(d.result.count<=0){b.append(this.createNoMatchHtml(d,c,a));return b;}b.append(this.createHeaderHtml(d,c,a));
b.append($("<div class='result-list' id='result_list'></div>").append(this.createHeaderAdHtml(d,c,a)).append(this.createListHtml(d,c,a)).append(this.createWaiWaiPreview(c,a)).append(this.createFooterAdHtml(d,c,a)));b.append(this.createFooterHtml(d,c,a));return b;};YGeoSearchLayer.prototype.createListHtml=function(g,e,a){var c=$('<ul id="list-items" class="srchrsltlst"></ul>');for(var b=0;b<g.result.count;
b++){var d=g.features[b];if(d){c.append(this.createItemHtml(b,d));}}var h=this;if(!this.select){this.select=this.bind("infowindowopen",function(f){var i=$("#list-item-"+f.id);i.css({backgroundColor:"lightyellow"});h.selectItem=i;});}if(!this.unselect){this.unselect=this.map.bind("infowindowclose",function(){$("#list-items").find("li").css({backgroundColor:""});h.selectItem=null;});}return c;};YGeoSearchLayer.prototype.createItemHtml=function(h,j){var f=this;
h++;var g="";if(j.property.Station&&j.property.Station.Name){var g="";if(j.property.Tel){g=j.property.Tel+" | ";}g=$("<dd></dd>").append(g+j.property.Station.Name+"から徒歩約"+j.property.Station.Time+"分");}var a="";if(j.property.Rating!=undefined&&j.property.Rating!=0){var e=Math.round(j.property.Rating*2);a=$("<dd></dd>").append("採点：<img src='http://i.yimg.jp/images/clear.gif' alt='"+j.property.Rating+"' class='valstars"+e+"'>（"+j.property.Rating+"）");
}var d="";if(j.category[0]){j.property.PhoneCategory=j.property.PhoneCategory||{};j.property.PhoneCategory.name=j.category[0];}if(j.property.PhoneCategory&&j.property.PropName=="health"){j.property.PhoneCategory={};j.property.PhoneCategory.name=j.property.Kamoku;}if(!j.property.PhoneCategory&&j.property.PropName=="realestate"){j.property.PhoneCategory={};j.property.PhoneCategory.name="新築マンション";}if(j.property.PhoneCategory){var c="";
for(var b in j.property.PhoneCategory){if(j.property.PhoneCategory[b].name){if(c!=""){c+=",";}c+=j.property.PhoneCategory[b].name;}}if(c!=""){j.property.PhoneCategory.name=c;}}if(j.property.PhoneCategory){if(j.property.PhoneCategory.name==undefined){j.property.PhoneCategory.name="その他";}d=$("<dd class='rsltlsttxtct'></dd>").append("カテゴリ："+j.property.PhoneCategory.name);}var i=$("<li id='list-item-"+j.id+"' ></li>").css({cursor:"pointer"}).append($("<img src='http://i.yimg.jp/images/clear.gif' alt='"+h+"' class='listnum"+h+" iepngfix'>")).append($("<dl class='rsltlsttxt'></dl>").append($("<dt></dt>").append($("<a href='javascript:void(0)'>"+j.name+"</a>")).append($("<img src='http://i.yimg.jp/images/clear.gif' alt='詳細' class='rsltdtl'>").click(function(k){if(f.selectItem&&f.selectItem.attr("id")==i.attr("id")){f.map.closeInfoWindow();
}else{f.openInfoWindow(j,true);}k.stopPropagation();}))).append(g).append(a).append(d)).click(function(){if(f.selectItem&&f.selectItem.attr("id")==i.attr("id")){f.map.closeInfoWindow();}else{f.openInfoWindow(j);}});i.bind("mouseover",function(){if(j.overEvt){clearTimeout(j.overEvt);delete j.overEvt;}j.overEvt=setTimeout(function(){j.focus();delete j.overEvt;},10);});i.bind("mouseout",function(){if(j.overEvt){clearTimeout(j.overEvt);
delete j.overEvt;}j.overEvt=setTimeout(function(){j.blur();delete j.overEvt;},10);});return i;};YGeoSearchLayer.prototype.createHeaderHtml=function(f,d,a){var g=this;var e=$('<div id="result_header"></div>');e.append($("<p class='othrplcinfo'></p>").append('<img class="mrkrdtr" alt="" src="http://i.yimg.jp/images/clear.gif"/><a href="javascript:$m.showCategory();">検索キーワードを変更する</a>').append('<span class="todd"><img class="dspchng" alt="" src="http://i.yimg.jp/images/clear.gif"/><a href="javascript:$m.sendURL(\'text\')">検索結果を一覧表示</a></span>'));
if(d!=""){e.append("<h4><strong>"+d+"</strong>で検索した結果</h4>");}else{if(this.uid!=""&&f.result.count>0){e.append("<h4><strong>"+f.features[0].name+"</strong>で検索した結果</h4>");}}var c="";if(f.result.total==1){c="<strong>1</strong>件 / <strong>"+f.result.total+"</strong>件中";}else{c="<strong>"+f.result.start+"</strong>～<strong>"+f.result.end+"</strong>件 / <strong>"+f.result.total+"</strong>件中";}e.append($("<div class='nmbrr'></div>").append($("<p class='list-msr'></p>").append(c)).append($("<p class='hlpr'></p>").append("<img height='15' width='13' class='helpicon' alt='ヘルプ' src='http://i.yimg.jp/images/common/helpicon.gif'/><a href='http://help.yahoo.co.jp/help/jp/maps/maps-22.html' target='help'>検索結果の見方</a>")));
var b=$("<div class='head_kw'></div>");e.append(b);return e;};YGeoSearchLayer.prototype.createFooterHtml=function(g,f,c){var h=this;var d=$("<div class='chunk'></div>");var e=this.getCurrentPage();var a=this.getTotalPageCount();if(e>1){d.append(" <a class='prev' rel='"+(e-1)+"' href='javascript:void(0)'><span>前へ</span><img src='http://i.yimg.jp/images/clear.gif'></a> ");}if(e<3||a<=5){for(var b=1;b<=a&&b<=5;
b++){if(e==b){d.append(" <span class='select'>"+b+"</span> ");}else{d.append(" <a rel='"+b+"' href='javascript:void(0);'>"+b+"</a> ");}}}else{if(e>a-2){for(var b=a-4;b<=a;b++){if(e==b){d.append(" <span class='select'>"+b+"</span> ");}else{d.append(" <a rel='"+b+"' href='javascript:void(0);'>"+b+"</a> ");}}}else{for(var b=e-2;b<=e+2;b++){if(e==b){d.append(" <span class='select'>"+b+"</span> ");}else{d.append(" <a rel='"+b+"' href='javascript:void(0);'>"+b+"</a> ");
}}}}if(e<a){d.append(" <a class='next' rel='"+(e+1)+"' href='javascript:void(0);'><img src='http://i.yimg.jp/images/clear.gif'  /><span>次へ</span></a> ");}var h=this;d.find("a").click(function(){var i=$(this).attr("rel");setTimeout(function(){h.drawPage(i);},0);});if(a==1){d="";}return d;};YGeoSearchLayer.prototype.createHeaderAdHtml=function(d,c,a){this.headAdList=$("<ul></ul>");var b=this.headAd=$('<div class="head_kw" style="display:none;"></div>');
b.append($('<div class="pos-lisi-ss"></div>').append('<p class="ssttl"><a href="http://business.yahoo.co.jp/sponsor/">スポンサードサーチ</a></p>').append(this.headAdList));return b;};YGeoSearchLayer.prototype.createFooterAdHtml=function(e,d,a){this.footAdList=$("<ul></ul>");var b=this.footAd=$('<div class="head_kw" style="display:none;"></div>');b.append($('<div class="pos-lisi-ss"></div>').append('<p class="ssttl"><a href="http://business.yahoo.co.jp/sponsor/">スポンサードサーチ</a></p>').append(this.footAdList));
var c=new OvertureAd();var f=this;c.getKeywordMatch(d,{},function(g){f.headAdList.html("");f.footAdList.html("");for(var j=0;j<g.length&&j<3;j++){var k=g[j];k.text=k.text.replace(d,"<b>"+d+"</b>");k.name=k.name.replace(d,"<b>"+d+"</b>");var h=$('<li><dl><dt><a href="'+k.url+'">'+k.name+"</a></dt><dd>"+k.text+"<em>"+k.host+"</em></dd></li>");if(j==0){f.headAd.show();f.headAdList.append(h);}else{f.footAd.show();
f.footAdList.append(h);}}});return b;};YGeoSearchLayer.prototype.createNoMatchHtml=function(d,c,a){var b=$("<b>次の条件に一致する情報は見つかりませんでした。</b><p>検索キーワード："+c+"</p>");return b;};YGeoSearchLayer.prototype.createInfoWindowHtml=YGeoSearchDotLayer.prototype.createInfoWindowHtml=function(p){var m=this;var f="";if(p.property.Place&&p.property.Place.MapType&&p.property.Place.MapType=="b1"){if(!(this.map.currentLayerSetId=="map-b1")&&!(this.map.currentLayerSetId=="b1")){f=$("<a href='javascript:void(0);'>地下街マップ</a>").click(function(s){m.map.changeLayerSet(Y.B1_LAYERSET,true);
setTimeout(function(){m.openInfoWindow(p,false);},1000);});}}else{f=$("<a href='javascript:void(0);'>道案内</a>").click(function(s){$m.drawNearestStation(p.latlng,p.title);s.stopPropagation();});}var b=$("<p class='route'></p>");if(p.property.Station){b.append(p.property.Station.Name+"から徒歩約"+p.property.Station.Time+"分").append($("<a href='http://help.yahoo.co.jp/help/jp/maps/maps-30.html' target='_ymhlp'></a>").append('<img height="15" width="13" class="helpicon" alt="ヘルプ" src="http://i.yimg.jp/images/common/helpicon.gif"/>'));
if(f!=""){b.append("（").append(f).append("）");}}var q=$("<p class='adress'></p>");if(p.property.Tel&&typeof(p.property.Tel)=="string"){q.append(p.property.Tel);}if(p.property.Address&&typeof(p.property.Address)!="string"){if(p.property.Address[0]&&typeof(p.property.Address[0])=="string"){p.property.Address=p.property.Address[0];}}var g=$("<p class='adress'></p>");if(p.property.Address&&typeof(p.property.Address)=="string"){g.append($("<span class='normal'></span>").append($m.omit(p.property.Address,15))).append($("<span class='detail'></span>").append(p.property.Address).css({display:"none"}));
}var j=$("<p class='more'></p>");j.append('<img src="http://i.yimg.jp/images/clear.gif" alt="" class="mrkarrw" />').append($("<a href='javascript:void(0);'>詳細を表示する</a>").click(function(s){p.layer=m;m.openInfoWindow(p,true);s.stopPropagation();}));var e=$("<p class='photo'></p>");var c="90";var o="";if(p.property.Images&&p.property.Images.Image&&p.property.Images.Image[0]){var l=p.property.Images.Image[0];
if(l.Height){c=l.Height;}if(l.Width){o=l.Width;}}if(p.property.ImageWidth){o=p.property.ImageWidth;}if(p.property.ImageHeight){c=p.property.ImageHeight;}if(o>120){o=120;c="";}if(p.property.Image!=null){var i=p.property.Image[0]||p.property.Image;if(!i.Url&&p.property.Image[1]){i=p.property.Image[1];}if(i){if(typeof(i.Url)=="string"){i.Memo=i.Memo||"";var r=$("<img src='"+i.Url+"'>");if(c!=""){r.attr("height",c);
}if(o!=""){r.attr("width",o);}r.load(function(){$m.resizeImage(this,120,90);});e.append(r);}}if(typeof(p.property.Image)=="string"){var r=$("<img src='"+p.property.Image+"'>");if(c!=""){r.attr("height",c);}if(o!=""){r.attr("width",o);}r.load(function(){$m.resizeImage(this,120,90);});e.append(r);}}var h=p.getLatLng();var d=$("<ul class='tofrnd'></ul>");d.append($("<li></li>").append('<img src="http://i.yimg.jp/images/maps/m2f/emailad.gif" alt="" width="16" height="15">').append($("<a href='javascript:$m.mailToFriend(\""+p.title+"周辺の地図\");'>友だちに教える</a>"))).append($("<li></li>").append('<img src="http://i.yimg.jp/i/ws/ic/mobile1.gif" alt="" width="16" height="16" />').append($("<a href='javascript:$m.mailToMobile("+h.lat()+","+h.lng()+',"'+p.title+"周辺の地図\");'>ケータイに送る</a>")));
if(!$m.popup.prop[p.property.PropCode]){p.property.PropCode=3024;}if($m.popup.prop[p.property.PropCode].icon==""){var n=$('<img src="http://i.yimg.jp/images/clear.gif" alt="" class="phnbk" />');}else{var n=$('<img src="http://i.yimg.jp/images/sicons/'+$m.popup.prop[p.property.PropCode].icon+'" align="absmiddle" alt="Yahoo!'+$m.popup.prop[p.property.PropCode].name+'"/>');}var a;if(p.property.PcUrl&&p.property.PcUrl!=""){if(p.property.IsExternalContents=="true"){a=$("<a href='javascript:$m.openPropUrl(\""+p.property.PcUrl+"\")'>"+p.name+"</a><font color='#808080'>（外部サイト）</font>");
}else{a=$("<a href='javascript:$m.openPropUrl(\""+p.property.PcUrl+"\")'>"+p.name+"</a>");}}else{a=$("<spna>"+p.name+"</span>");}var k=$("<div class='fkdsh'></div>");k.append($('<p class="fkdshttl"></p>').append(n).append(a)).append($("<div class='fkdshcntnt'></div>").append(e).append(b).append(g).append(q).append(j).append(d).append($("<p>（Yahoo! JAPAN IDでのログインが必要です）</p>")));return k;};YGeoSearchLayer.prototype.createInfoWindowMaxContentHtml=YGeoSearchDotLayer.prototype.createInfoWindowMaxContentHtml=function(a){var d=this;
var c=this.createInfoWindowHtml(a);if(this.isFirstPop==null){this.isFirstPop=true;}var b="detail";if(this.isFirstPop){b=$m.param.get("pop");if(b!="detail"&&b!="image"&&b!="web"&&b!="blog"){b="detail";}this.isFirstPop=false;}$m.popup.createGeoSearchDetail(a,b,function(e){c.append(e);c.find("p[class='more']").hide();c.find("span[class='normal']").hide();c.find("span[class='detail']").show();c.find(".mid_summary_image img").load(function(){$m.resizeImage(this,120,90);
});});return c;};var YWaiWaiSearchDotLayer=Y.extend(YGeoSearchDotLayer,function(){YGeoSearchDotLayer.apply(this);});YWaiWaiSearchDotLayer.prototype.getCustomIcon=function(b){var a=new Y.Icon("");a.iconHtml=$('<p class="yolp-sptgrnicn"></p>').append($('<img src="'+Y.ICON_IMAGE_URL+'" alt="" />').loadAlphaImage());a.iconSize=new Y.Size(11,13);a.iconAnchor=new Y.Point(3,11);a.infoWindowAnchor=new Y.Point(4,0);a.labelAnchor=new Y.Point(6,-5);
return a;};YWaiWaiSearchDotLayer.prototype.getApiRequest=function(b,a){a.opt=a.opt||{};a.opt.rep="2";a.detail=a.detail||"simple";if(b==""){b="ワイワイ";}return YGeoSearchDotLayer.prototype.getApiRequest.apply(this,[b,a]);};var YWaiWaiSearchLayer=Y.extend(YGeoSearchLayer,function(a){YGeoSearchLayer.apply(this,[a]);});YWaiWaiSearchLayer.prototype.remove=function(){if(this.select){this.unbind(this.select);
this.select=null;}if(this.unselect){this.map.unbind(this.unselect);this.unselect=null;}YGeoSearchLayer.prototype.remove.apply(this);};YWaiWaiSearchLayer.prototype.getCustomIcon=function(a){var b=new Y.Icon("");b.iconHtml=$('<p class="yolp-sptlistnum'+(a+1)+'">').append($('<img src="'+Y.ICON_IMAGE_URL+'" alt=""/>').loadAlphaImage());b.iconSize=new Y.Size(24,35);b.iconAnchor=new Y.Point(12,35);b.labelAnchor=new Y.Point(12,-22);
b.infoWindowAnchor=new Y.Point(12,0);return b;};YWaiWaiSearchLayer.prototype.getApiRequest=function(b,a){a.opt=a.opt||{};a.opt.rep="2";a.detail="";if(b==""){b="ワイワイ";}var c=YGeoSearchLayer.prototype.getApiRequest.apply(this,[b,a]);return c;};YWaiWaiSearchLayer.prototype.createListHtml=function(g,e,a){var c=$('<ul id="list-items" class="sptrsltlst"></ul>');for(var b=0;b<g.result.count;b++){var d=g.features[b];
c.append(this.createItemHtml(b,d));}var h=this;if(!this.select){this.select=this.bind("infowindowopen",function(f){var i=$("#list-item-"+f.id);i.css({backgroundColor:"lightyellow"});h.selectItem=i;});}if(!this.unselect){this.unselect=this.map.bind("infowindowclose",function(){$("#list-items").find("li").css({backgroundColor:""});h.selectItem=null;});}return c;};YWaiWaiSearchLayer.prototype.createItemHtml=function(b,c){b++;
var d=this;var a=$("<li id='list-item-"+c.id+"' style='cursor:pointer;'></li>").append($("<img src='http://i.yimg.jp/images/clear.gif' alt='"+b+"' class='listnum"+b+"'>")).append($("<dl class='rsltlsttxt'></dl>").append($("<dt></dt>").append("<a href='javascript:void(0);'>"+c.name+"</a>")).append($("<dd></dd>").append(c.property.PhoneCategory.name))).bind("click",function(){if(d.selectItem&&d.selectItem.attr("id")==a.attr("id")){d.map.closeInfoWindow();
}else{d.openInfoWindow(c);}});a.bind("mouseover",function(){if(c.overEvt){clearTimeout(c.overEvt);delete c.overEvt;}c.overEvt=setTimeout(function(){c.focus();delete c.overEvt;},10);});a.bind("mouseout",function(){if(c.overEvt){clearTimeout(c.overEvt);delete c.overEvt;}c.overEvt=setTimeout(function(){c.blur();delete c.overEvt;},10);});return a;};YWaiWaiSearchLayer.prototype.createHeaderHtml=function(f,d,a){var g=this;
var e=$('<div id="result_header"></div>');if(d==""){d="投稿スポット";}e.append($("<p class='othrplcinfo'></p>").append('<img class="mrkrdtr" alt="" src="http://i.yimg.jp/images/clear.gif"/><a href="javascript:$m.showCategory();">検索キーワードを変更する</a>'));if(a.opt.g3&&a.opt.g3!=""&&f.features[0]&&f.features[0].property.PhoneCategory.name){d=f.features[0].property.PhoneCategory.name;e.append("<h4><strong>"+d+"</strong>で検索した結果</h4>");
$("#address span").html("&nbsp;>&nbsp;"+d+"で検索した結果");}else{e.append("<h4><strong>"+d+"</strong>で検索した結果</h4>");}var c="";if(f.result.total==1){c="<strong>1</strong>件 / <strong>"+f.result.total+"</strong>件中";}else{c="<strong>"+f.result.start+"</strong>～<strong>"+f.result.end+"</strong>件 / <strong>"+f.result.total+"</strong>件中";}e.append($("<div class='nmbrr'></div>").append($("<p class='list-msr'></p>").append(c)).append($("<p class='hlpr'></p>").append("<img height='15' width='13' class='helpicon' alt='ヘルプ' src='http://i.yimg.jp/images/common/helpicon.gif'/><a href='http://help.yahoo.co.jp/help/jp/maps/maps-22.html' target='help'>検索結果の見方</a>")));
e.append($("<ul class='srchcndtn'></ul>").append($("<li class='waiwai'>この情報は、「ワイワイマップ」参加者による投稿情報です。</li>")));var b=$("<div class='head_kw'></div>");e.append(b);return e;};YWaiWaiSearchLayer.prototype.createWaiWaiPreview=function(d,b){var e=$('<ul class="pstspt"></ul>');var c=new YGeoSearchLayer();var a={};a.bbox=b.bbox;c.search(d,a,function(j){if(j.result.count>0){e.show();e.append($('<li class="pstsptall"><a href="javascript:void(0);">'+d+"での周辺検索結果</a></li>").click(function(){setTimeout(function(){$m.searchPoi(d,Parameter.FUNC_AREASEARCH);
},0);}));for(var g in j.features){var h=j.features[g];e.append($("<li></li>").click((function(f){return function(){$m.searchPoi(d,Parameter.FUNC_AREASEARCH,{uid:f,pop:"normal"});};})(h.id)).append('<img class="mrkarrw" alt="" src="http://i.yimg.jp/images/clear.gif"/>').append("<a href='javascript:void(0);'>"+h.name+"</a>"));if(g>0){break;}}}else{e.hide();}});return e;};YWaiWaiSearchLayer.prototype.createInfoWindowHtml=YWaiWaiSearchDotLayer.prototype.createInfoWindowHtml=function(c){var d=$("<p class='photo'></p>");
if(c.property.Image&&c.property.Image.Url){d.append($("<img src='"+c.property.Image.Url+"' />"));}var a="";if(c.property.UserUrl){a="<a href='javascript:$m.openPropUrl(\""+c.property.UserUrl+"\")'>関連サイトを見る</a>";}var b=$("<div class='fkdsh'></div>");b.append($('<p class="fkdshttl"></p>').append($('<img src="http://i.yimg.jp/images/map/icon/yymap16.gif" align="absmiddle" alt="ワイワイマップ"/>')).append("<a href='javascript:$m.openPropUrl(\""+c.property.PcUrl+"\")'>"+c.name+"</a>")).append($("<div class='fkdshcntnt'></div>").append(d).append("<b>※この情報は、「ワイワイマップ」参加者による投稿情報です。</b>").append("<div>"+c.property.Contents+"</div>").append("<div>"+a+"</div>").append($("<div></div>").append(c.property.Createdate.replace(/-/g,"/")).append("&nbsp;<a href='javascript:$m.openPropUrl(\""+c.property.PcUrl+"\")'>コメント（"+c.property.CommentCount+"）</a>")).append("<p class='more'><img class='mrkarrw' src='http://i.yimg.jp/images/clear.gif'><a href='javascript:$m.openPropUrl(\""+c.property.PcUrl+"\");'>ワイワイマップで詳細情報を見る</a></p>"));
return b;};YWaiWaiSearchLayer.prototype.createInfoWindowMaxContentHtml=YWaiWaiSearchDotLayer.prototype.createInfoWindowMaxContentHtml=function(a){};var YBlogSearchLayer=Y.extend(Y.ListingLayer,function(){Y.ListingLayer.apply(this);this.url="/api/search_blog";this.autoPanMap=false;this.setAutoUpdate(true,2,1);});YBlogSearchLayer.prototype.remove=function(){if(this.select){this.unbind(this.select);this.select=null;}if(this.unselect){this.map.unbind(this.unselect);this.unselect=null;}Y.ListingLayer.prototype.remove.apply(this);};YBlogSearchLayer.prototype.getApiRequest=function(b,a){var c=Y.ListingLayer.prototype.getApiRequest(b,a);
c.sort="score";c.is_adult="0";c.datum="wgs";c.detail="normal";return c;};YBlogSearchLayer.prototype.getCustomIcon=function(a,b){var c=new Y.Icon(b.property.image+"_m");c.iconSize=new Y.Size(76,54);c.className="blog-icon";return c;};YBlogSearchLayer.prototype.createResultHtml=function(d,c,a){var b=$('<div class="yolp-list"></div>');if(d.result.count<=0){b.append(this.createNoMatchHtml(d,c,a));return b;
}b.append(this.createHeaderHtml(d,c,a));b.append($("<div class='result-list' id='result_list'></div>").append(this.createListHtml(d,c,a)));b.append(this.createFooterHtml(d,c,a));return b;};YBlogSearchLayer.prototype.createNoMatchHtml=function(d,c,a){var b=$('<p class="nmtchtxt">条件に一致するブログ、サイトは見つかりませんでした。</p>');return b;};YBlogSearchLayer.prototype.createHeaderHtml=function(f,d,a){var g=this;var e=$('<div id="result_header"></div>');
e.append($("<p class='othrplcinfo'></p>").append('<img class="mrkrdtr" alt="" src="http://i.yimg.jp/images/clear.gif"/><a href="javascript:$m.showCategory();">検索キーワードを変更する</a>'));e.append("<h4>この周辺の地図がはりつけられたブログ、サイトを検索した結果</h4>");var c="";if(f.result.total==1){c="<strong>1</strong>件 / <strong>"+f.result.total+"</strong>件中";}else{c="<strong>"+f.result.start+"</strong>～<strong>"+f.result.end+"</strong>件 / <strong>"+f.result.total+"</strong>件中";
}e.append($("<div class='nmbrr'></div>").append($("<p class='list-msr'></p>").append(c)).append($("<p class='hlpr'></p>").append("<img height='15' width='13' class='helpicon' alt='ヘルプ' src='http://i.yimg.jp/images/common/helpicon.gif'/><a href='http://help.yahoo.co.jp/help/jp/maps/maps-22.html' target='help'>検索結果の見方</a>")));e.append($("<p class='blgpromo'></p>").append($("<img src='http://i.yimg.jp/images/clear.gif' alt='' class='mrkarrw'/>")).append($("<a href='javascript:$m.clickPromoPaste();'>ブログに地図をはりつけるには？</a>")));
e.append($("<ul class='srchcndtn'></ul>").append($("<li class='blg'>この情報は、この周辺の地図がはりつけられているブログ、サイトの情報です。</li>")));var b=$("<div class='head_kw'></div>");e.append(b);return e;};YBlogSearchLayer.prototype.createListHtml=function(g,e,a){var c=$('<ul id="list-items" class="blgrsltlst"></ul>');for(var b=0;b<g.result.count;b++){var d=g.features[b];c.append(this.createItemHtml(b,d));}var h=this;if(!this.select){this.select=this.bind("infowindowopen",function(f){var i=$("#list-item-"+f.id);
i.css({background:"#FFFCCC none repeat scroll 0 0"});h.selectItem=i;});}if(!this.unselect){this.unselect=this.map.bind("infowindowclose",function(){$("#list-items").find("li").css({background:"#FFFFFF url(http://i.yimg.jp/images/map/v2_2/images/bg.png) repeat-x scroll 0 -767px"});h.selectItem=null;});}return c;};YBlogSearchLayer.prototype.createItemHtml=function(c,d){var e=this;var b=d.name;if(b.length>23){b=b.slice(0,23)+"...";
}var a=$('<li id="list-item-'+d.id+'" style="cursor:pointer;"></li>');a.append('<p class="blgrsltlstimg"><img height="84" border="0" width="117" src="'+d.property.image+'_l"/></p>');a.append('<p class="blgrsltlsttxt"><a href="javascript:void(0)">'+b+"</a></p>");a.bind("click",function(){if(e.selectItem&&e.selectItem.attr("id")==a.attr("id")){e.map.closeInfoWindow();}else{e.openInfoWindow(d);}});a.bind("mouseover",function(){if(d.overEvt){clearTimeout(d.overEvt);
delete d.overEvt;}d.overEvt=setTimeout(function(){d.focus();delete d.overEvt;},10);});a.bind("mouseout",function(){if(d.overEvt){clearTimeout(d.overEvt);delete d.overEvt;}d.overEvt=setTimeout(function(){d.blur();delete d.overEvt;},10);});return a;};YBlogSearchLayer.prototype.createFooterHtml=YGeoSearchLayer.prototype.createFooterHtml;YBlogSearchLayer.prototype.createInfoWindowHtml=function(n){var g=this;
var c=n.latlng;var a=n.property.outline;if(a.length>50){a=a.slice(0,50)+"...";}else{if(a=="--"){a="<br/>";}}var b=n.name;if(b.length>25){b=b.slice(0,25)+"...";}violation=$m.getAbuseUrl(c.Lat,c.Lon,n.property.blogmapID,n.property.url);var d=$("<div class='fkdsh'></div>");var k=$('<p class="fkdshttl"></p>').append($('<img src="http://i.yimg.jp/images/clear.gif" alt="" class="blgicn" />')).append("<a href='javascript:$m.openPropUrl(\""+n.property.url+"\")'>"+b+"</a>");
if(!n.property.url.match("yahoo.co.jp")){k.append($("<span>（外部リンク）</span>"));}var j=n.property.blogtitle;if(j.length>25){j=j.slice(0,25)+"...";}var i=$("<div class='fkdshcntnt'></div>");var h=$("<p class='photo'></p>");if(n.property.image){h.append("<img src='"+n.property.image+"_l'>");}i.append(h);i.append("<div>"+a+"</div>");if(n.property.blogurl&&n.property.blogurl!=""){i.append($("<a href=\"javascript:$m.openPropUrl('"+n.property.blogurl+"')\">>>"+j+"</a>"));
if(!n.property.url.match("yahoo.co.jp")){i.append($("<span>（外部リンク）</span>"));}}var m="「"+b+"」にはりつけられている地図";var e="「"+b+"」にはりつけられている地図";var l=$("<ul class='tofrnd'></ul>").append($("<li></li>").append($('<img height="16" border="0" align="absmiddle" width="16" src="http://i.yimg.jp/images/maps/m2f/emailad.gif"/>')).append($("<a href=\"javascript:$m.mailToFriend('"+m+"');\">友だちに教える</a>"))).append($("<li></li>").append($('<img height="16" border="0" align="absmiddle" width="16" src="http://i.yimg.jp/i/ws/ic/mobile1.gif"/>')).append($('<a href="javascript:$m.mailToMobile('+c.Lat+","+c.Lon+",'"+e+"');\">ケータイに送る</a>")));
var f=$("<p>（Yahoo! JAPAN IDでのログインが必要です）</p>").append('<span class="Right">[ <a href="'+violation+'">問題のあるブログ、サイトを報告する</a> ]</span>');i.append(l);i.append(f);d.append(k);d.append(i);return d;};YBlogSearchLayer.prototype.openInfoWindowOfUid=function(d,c){if(!this.ydf){return;}for(var b=0;b<this.ydf.result.count;b++){var a=this.ydf.features[b];if(a.id==d){this.openInfoWindow(a,c);return;}}};var YBlogSearchDotLayer=Y.extend(YBlogSearchLayer,function(){YBlogSearchLayer.apply(this);
this.autoPanMap=false;this.setAutoUpdate(true,2,2);});YBlogSearchDotLayer.prototype.getCustomIcon=function(a,b){var c=new Y.Icon(b.property.image+"_s");c.iconSize=new Y.Size(31,22);c.className="blog-icon";return c;};YBlogSearchDotLayer.prototype.getApiRequest=function(b,a){var c=Y.ListingLayer.prototype.getApiRequest(b,a);c.sort="score";c.is_adult="0";c.datum="wgs";c.detail="normal";c.results=50;return c;
};YBlogSearchDotLayer.prototype.createInfoWindowHtml=YBlogSearchLayer.prototype.createInfoWindowHtml;